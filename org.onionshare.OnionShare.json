{
  "app-id": "org.onionshare.OnionShare",
  "command": "onionshare",
  "runtime": "org.kde.Platform",
  "runtime-version": "5.14",
  "sdk": "org.kde.Sdk",
  "separate-locales": false,
  "finish-args": [
    "--device=dri",
    "--share=ipc",
    "--share=network",
    "--socket=wayland",
    "--socket=x11",
    "--talk-name=org.freedesktop.Flatpak",
    "--talk-name=org.freedesktop.Notifications",
    "--talk-name=org.freedesktop.secrets",
    "--filesystem=home:ro",
    "--filesystem=~/OnionShare:create",
    "--filesystem=xdg-config/onionshare:create"
  ],
  "modules": [
    {
      "name": "pyqt5",
      "config-opts": [
        "--disable-static",
        "--enable-x11"
      ],
      "sources": [
        {
          "type": "archive",
          "sha256": "0145a6b7de15756366decb736c349a0cb510d706c83fda5b8cd9e0557bc1da72",
          "url": "https://files.pythonhosted.org/packages/7c/5b/e760ec4f868cb77cee45b4554bf15d3fe6972176e89c4e3faac941213694/PyQt5-5.14.0.tar.gz"
        },
        {
          "type": "script",
          "commands": [
            "python3 configure.py --disable QtBluetooth --disable QtDesigner --disable QtHelp --disable QtLocation --disable QtMacExtras --disable QtNfc --disable QtPositioning --disable QtPrintSupport --disable QtSensors --disable QtSerialPort --disable QtSql --disable QtTest --disable QtWinExtras --assume-shared --confirm-license --no-designer-plugin --no-docstrings --no-qml-plugin --no-tools --destdir ${FLATPAK_DEST}/lib/python3.7/site-packages/ --qsci-api-destdir=${FLATPAK_DEST}/qsci/ --sip=${FLATPAK_DEST}/bin/sip --sip-incdir=${FLATPAK_DEST}/include/ --sipdir=${FLATPAK_DEST}/share/sip/ --stubsdir ${FLATPAK_DEST}/lib/python3.7/site-packages/ --sysroot=${FLATPAK_DEST}/ QMAKE_CFLAGS_RELEASE='-I/usr/include/python3.7m/' QMAKE_CXXFLAGS_RELEASE='-I/usr/include/python3.7m/'"
          ],
          "dest-filename": "configure"
        }
      ],
      "modules": [
        {
          "name": "sip",
          "cleanup": [
            "/bin",
            "/include"
          ],
          "sources": [
            {
              "type": "archive",
              "sha256": "e1b768824ec1a2ee38dd536b6b6b3d06de27b00a2f5f55470d1b512306e3be45",
              "url": "https://www.riverbankcomputing.com/static/Downloads/sip/4.19.22/sip-4.19.22.tar.gz"
            },
            {
              "type": "script",
              "commands": [
                "python3 configure.py --bindir ${FLATPAK_DEST}/bin/ --destdir ${FLATPAK_DEST}/lib/python3.7/site-packages/ --incdir ${FLATPAK_DEST}/include/ --sipdir ${FLATPAK_DEST}/share/sip/ --stubsdir ${FLATPAK_DEST}/lib/python3.7/site-packages/ --sip-module PyQt5.sip"
              ],
              "dest-filename": "configure"
            }
          ]
        }
      ]
    },
    {
      "name": "tor",
      "buildsystem": "simple",
      "build-commands": [
        "./configure --prefix=${FLATPAK_DEST}",
        "make",
        "make install"
      ],
      "sources": [
        {
          "type": "archive",
          "sha256": "06a1d835ddf382f6bca40a62e8fb40b71b2f73d56f0d53523c8bd5caf9b3026d",
          "url": "https://dist.torproject.org/tor-0.4.2.7.tar.gz"
        }
      ],
      "modules": [
        {
          "name": "libevent",
          "buildsystem": "simple",
          "build-commands": [
            "./configure --prefix=${FLATPAK_DEST}",
            "make",
            "make install"
          ],
          "sources": [
            {
              "type": "archive",
              "url": "https://github.com/libevent/libevent/releases/download/release-2.1.11-stable/libevent-2.1.11-stable.tar.gz",
              "sha256": "a65bac6202ea8c5609fd5c7e480e6d25de467ea1917c08290c521752f147283d"
            }
          ]
        }
      ]
    },
    {
      "name": "onionshare",
      "buildsystem": "simple",
      "build-commands": [
        "python3 setup.py install --prefix=${FLATPAK_DEST}",
        "install -D -m0755 onionshare.sh ${FLATPAK_DEST}/bin/onionshare",
        "install -D -m0644 install/org.onionshare.OnionShare.appdata.xml ${FLATPAK_DEST}/share/metainfo/${FLATPAK_ID}.appdata.xml"
      ],
      "sources": [
        {
          "type": "archive",
          "sha256": "c79c34a725b6bd79f56ecc870368133189896e478cf1cc757d71f447ffadada6",
          "url": "https://github.com/micahflee/onionshare/archive/910_flatpak.zip"
        },
        {
          "type": "script",
          "commands": [
            "exec /app/bin/onionshare-gui \"$@\""
          ],
          "dest-filename": "onionshare.sh"
        }
      ],
      "modules": [
        {
          "name": "poetry-deps",
          "buildsystem": "simple",
          "build-commands": [
            "pip3 install --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} altgraph atomicwrites attrs certifi chardet click colorama dis3 flask flask-httpauth future idna importlib-metadata itsdangerous jinja2 macholib markupsafe more-itertools packaging pefile pluggy py pycryptodome pyparsing pyqt5 pyqt5-sip pysocks pytest pytest-faulthandler pytest-qt requests six stem urllib3 wcwidth werkzeug zipp"
          ],
          "sources": [
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/ee/3d/bfca21174b162f6ce674953f1b7a640c1498357fa6184776029557c25399/altgraph-0.17-py2.py3-none-any.whl",
              "sha256": "c623e5f3408ca61d4016f23a681b9adb100802ca3e3da5e718915a9e4052cebe"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/ec/0f/cd484ac8820fed363b374af30049adc8fd13065720fd4f4c6be8a2309da7/atomicwrites-1.3.0.tar.gz",
              "sha256": "75a9445bac02d8d058d5e1fe689654ba5a6556a1dfd8ce6ec55a0ed79866cfa6"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/a2/db/4313ab3be961f7a763066401fb77f7748373b6094076ae2bda2806988af6/attrs-19.3.0-py2.py3-none-any.whl",
              "sha256": "08a96c641c3a74e44eb59afb61a24f2cb9f4d7188748e76ba4bb5edfa3cb7d1c"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/57/2b/26e37a4b034800c960a00c4e1b3d9ca5d7014e983e6e729e33ea2f36426c/certifi-2020.4.5.1-py2.py3-none-any.whl",
              "sha256": "1d987a998c75633c40847cc966fcf5904906c920a7f17ef374f5aa4282abd304"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/bc/a9/01ffebfb562e4274b6487b4bb1ddec7ca55ec7510b22e4c51f14098443b8/chardet-3.0.4-py2.py3-none-any.whl",
              "sha256": "fc323ffcaeaed0e0a02bf4d117757b98aed530d9ed4531e3e15460124c106691"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/dd/c0/4d8f43a9b16e289f36478422031b8a63b54b6ac3b1ba605d602f10dd54d6/click-7.1.1-py2.py3-none-any.whl",
              "sha256": "e345d143d80bf5ee7534056164e5e112ea5e22716bbb1ce727941f4c8b471b9a"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/c9/dc/45cdef1b4d119eb96316b3117e6d5708a08029992b2fee2c143c7a0a5cc5/colorama-0.4.3-py2.py3-none-any.whl",
              "sha256": "7d73d2a99753107a36ac6b455ee49046802e59d9d076ef8e47b61499fa29afff"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/43/b4/4fbe1d65716367d7eb00840c29f06cb7c6500b389911b0f8608ea81f43f7/dis3-0.1.3-py3-none-any.whl",
              "sha256": "30b6412d33d738663e8ded781b138f4b01116437f0872aa56aa3adba6aeff218"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/f2/28/2a03252dfb9ebf377f40fba6a7841b47083260bf8bd8e737b0c6952df83f/Flask-1.1.2-py2.py3-none-any.whl",
              "sha256": "8a4fdd8936eba2512e9c85df320a37e694c93945b33ef33c89946a340a238557"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/b9/fd/89fc9aa163b5a7aa809fac0835502c2b66f48a5114a73df7e2a104cc645f/Flask_HTTPAuth-3.3.0-py2.py3-none-any.whl",
              "sha256": "0149953720489407e51ec24bc2f86273597b7973d71cd51f9443bd0e2a89bd72"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/45/0b/38b06fd9b92dc2b68d58b75f900e97884c45bedd2ff83203d933cf5851c9/future-0.18.2.tar.gz",
              "sha256": "b1bead90b70cf6ec3f0710ae53a525360fa360d306a86583adc6bf83a4db537d"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/89/e3/afebe61c546d18fb1709a61bee788254b40e736cff7271c7de5de2dc4128/idna-2.9-py2.py3-none-any.whl",
              "sha256": "a068a21ceac8a4d63dbfd964670474107f541babbd2250d61922f029858365fa"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/ad/e4/891bfcaf868ccabc619942f27940c77a8a4b45fd8367098955bb7e152fb1/importlib_metadata-1.6.0-py2.py3-none-any.whl",
              "sha256": "2a688cbaa90e0cc587f1df48bdc97a6eadccdcd9c35fb3f976a09e3b5016d90f"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/76/ae/44b03b253d6fade317f32c24d100b3b35c2239807046a4c953c7b89fa49e/itsdangerous-1.1.0-py2.py3-none-any.whl",
              "sha256": "b12271b2047cb23eeb98c8b5622e2e5c5e9abd9784a153e9d8ef9cb4dd09d749"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/27/24/4f35961e5c669e96f6559760042a55b9bcfcdb82b9bdb3c8753dbe042e35/Jinja2-2.11.1-py2.py3-none-any.whl",
              "sha256": "b0eaf100007721b5c16c1fc1eecb87409464edc10469ddc9a22a27a99123be49"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/3c/e1/c12f8d6af5d745ce88f270aeb243cb2bd6d8186320e5122df87fded29e4e/macholib-1.14-py2.py3-none-any.whl",
              "sha256": "c500f02867515e6c60a27875b408920d18332ddf96b4035ef03beddd782d4281"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/b9/2e/64db92e53b86efccfaea71321f597fa2e1b2bd3853d8ce658568f7a13094/MarkupSafe-1.1.1.tar.gz",
              "sha256": "29872e92839765e546828bb7754a68c418d927cd064fd4708fab9fe9c8bb116b"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/72/96/4297306cc270eef1e3461da034a3bebe7c84eff052326b130824e98fc3fb/more_itertools-8.2.0-py3-none-any.whl",
              "sha256": "5dd8bcf33e5f9513ffa06d5ad33d78f31e1931ac9a18f33d37e77a180d393a7c"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/62/0a/34641d2bf5c917c96db0ded85ae4da25b6cd922d6b794648d4e7e07c88e5/packaging-20.3-py2.py3-none-any.whl",
              "sha256": "82f77b9bee21c1bafbf35a84905d604d5d1223801d639cf3ed140bd651c08752"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/36/58/acf7f35859d541985f0a6ea3c34baaefbfaee23642cf11e85fe36453ae77/pefile-2019.4.18.tar.gz",
              "sha256": "a5d6e8305c6b210849b47a6174ddf9c452b2888340b8177874b862ba6c207645"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/a0/28/85c7aa31b80d150b772fbe4a229487bc6644da9ccb7e427dd8cc60cb8a62/pluggy-0.13.1-py2.py3-none-any.whl",
              "sha256": "966c145cd83c96502c3c3868f50408687b38434af77734af1e9ca461a4081d2d"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/99/8d/21e1767c009211a62a8e3067280bfce76e89c9f876180308515942304d2d/py-1.8.1-py2.py3-none-any.whl",
              "sha256": "c20fdd83a5dbc0af9efd622bee9a5564e278f6380fffcacc43ba6f43db2813b0"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/69/2a/298b2689bee8e88c502c7e85ba1c9f07c7e182ea91c705c449f693056c9f/pycryptodome-3.9.7.tar.gz",
              "sha256": "f1add21b6d179179b3c177c33d18a2186a09cc0d3af41ff5ed3f377360b869f2"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/8a/bb/488841f56197b13700afd5658fc279a2025a39e22449b7cf29864669b15d/pyparsing-2.4.7-py2.py3-none-any.whl",
              "sha256": "ef9d7589ef3c200abe66653d3f1ab1033c3c419ae9b9bdb1240a85b024efc88b"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/7c/5b/e760ec4f868cb77cee45b4554bf15d3fe6972176e89c4e3faac941213694/PyQt5-5.14.0.tar.gz",
              "sha256": "0145a6b7de15756366decb736c349a0cb510d706c83fda5b8cd9e0557bc1da72"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/32/24/1537d09deb3aee2e5c390cd456420a455ac47ef3f8ac323d8397af1c1c13/PyQt5_sip-12.7.2.tar.gz",
              "sha256": "16a19b9f36985b8bff30b89fb8859d831713dd528fba5600563e36ff077960a2"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/8d/59/b4572118e098ac8e46e399a1dd0f2d85403ce8bbaad9ec79373ed6badaf9/PySocks-1.7.1-py3-none-any.whl",
              "sha256": "2725bd0a9925919b9b51739eea5f9e2bae91e83288108a9ad338b2e3a4435ee5"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/c7/e2/c19c667f42f72716a7d03e8dd4d6f63f47d39feadd44cc1ee7ca3089862c/pytest-5.4.1-py3-none-any.whl",
              "sha256": "0e5b30f5cb04e887b91b1ee519fa3d89049595f428c1db76e73bd7f17b09b172"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/f2/ed/a654dfc81c577135a658f8257e2ab8210dc48415cb4125bf36fb9ac7e1cc/pytest_faulthandler-2.0.1-py2.py3-none-any.whl",
              "sha256": "236430ba962fd1c910d670922be55fe5b25ea9bc3fc6561a0cafbb8759e7504d"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/38/b4/c1e8d65fac47eb48c265b7ab926cf5c439e5517fbdfc892dcf5e8aa303a5/pytest_qt-3.3.0-py2.py3-none-any.whl",
              "sha256": "5f8928288f50489d83f5d38caf2d7d9fcd6e7cf769947902caa4661dc7c851e3"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/1a/70/1935c770cb3be6e3a8b78ced23d7e0f3b187f5cbfab4749523ed65d7c9b1/requests-2.23.0-py2.py3-none-any.whl",
              "sha256": "43999036bfa82904b6af1d99e4882b560e5e2c68e5c4b0aa03b655f3d7d73fee"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/65/eb/1f97cb97bfc2390a276969c6fae16075da282f5058082d4cb10c6c5c1dba/six-1.14.0-py2.py3-none-any.whl",
              "sha256": "8f3cd2e254d8f793e7f3d6d9df77b92252b52637291d0f0da013c76ea2724b6c"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/71/bd/ab05ffcbfe74dca704e860312e00c53ef690b1ddcb23be7a4d9ea4f40260/stem-1.8.0.tar.gz",
              "sha256": "a0b48ea6224e95f22aa34c0bc3415f0eb4667ddeae3dfb5e32a6920c185568c2"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/e8/74/6e4f91745020f967d09332bb2b8b9b10090957334692eb88ea4afe91b77f/urllib3-1.25.8-py2.py3-none-any.whl",
              "sha256": "2f3db8b19923a873b3e5256dc9c2dedfa883e33d87c690d9c7913e1f40673cdc"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/f6/d5/1ecdac957e3ea12c1b319fcdee8b6917ffaff8b4644d673c4d72d2f20b49/wcwidth-0.1.9-py2.py3-none-any.whl",
              "sha256": "cafe2186b3c009a04067022ce1dcd79cb38d8d65ee4f4791b8888d6599d1bbe1"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/cc/94/5f7079a0e00bd6863ef8f1da638721e9da21e5bacee597595b318f71d62e/Werkzeug-1.0.1-py2.py3-none-any.whl",
              "sha256": "2de2a5db0baeae7b2d2664949077c2ac63fbd16d98da0ff71837f7d1dea3fd43"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/b2/34/bfcb43cc0ba81f527bc4f40ef41ba2ff4080e047acb0586b56b3d017ace4/zipp-3.1.0-py3-none-any.whl",
              "sha256": "aa36550ff0c0b7ef7fa639055d797116ee891440eac1a56f378e2d3179e0320b"
            }
          ]
        }
      ]
    }
  ]
}